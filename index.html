<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>MeowMapüêæ ‚Äî MapLibre only</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- MapLibre -->
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      display: flex; flex-direction: column; height: 100vh; height: 100svh; height: 100dvh;
    }
    #controls{
      display:flex;align-items:center;gap:8px;flex-wrap:wrap;
      padding:12px;background:#f7f7f7;border-bottom:1px solid #ccc;
    }
    input[type=date]{font-size:16px;flex:0 0 150px;}
    #logo{height:32px;max-width:100%;}
    #burger{cursor:pointer;font-size:26px;display:none;margin-left:auto;}
    #layout{flex:1;display:flex;position:relative;}
    #map{flex:1;width:100%;height:100%;}
    #sidebar{
      width:300px;background:#fff;overflow-y:auto;
      padding:12px;font-size:14px;border-left:1px solid #ccc;
      position:fixed;right:0;top:0;height:100%;
      transform:translateX(100%);
      transition:transform .3s; z-index:999; box-shadow:-4px 0 6px rgba(0,0,0,.15);
    }
    #sidebar.open{transform:translateX(0);}
    #sidebar .item{margin-bottom:12px;cursor:pointer;border-bottom:1px dashed #ccc;padding-bottom:8px;}
    #sidebar .item:hover{background:#f0f0f0;}
    #closeSidebar{cursor:pointer;font-size:22px;font-weight:bold;}
    @media (max-width:768px){
      #burger{display:block;}
      #controls{padding:8px;}
      input[type=date]{font-size:14px;}
      #logo{height:24px;}
      #sidebar{width:80%;max-width:300px;}
    }
  </style>
</head>
<body>
  <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <div id="controls">
    <label for="event-date">üìÖ</label>
    <input type="date" id="event-date" />
    <img id="logo"
         src="https://sun9-81.userapi.com/impf/rcuLPGnzIPly7IQhX6MbA5TICbdWnl6AhMVSXQ/dFRCwb6vi5k.jpg?size=1818x606&quality=95&crop=0,21,1541,513&sign=34cbe06fb366638d9c7ca0693f1f83ef&type=cover_group"
         alt="Meow Records" />
    <span id="burger">‚ò∞</span>
  </div>

  <!-- –ú–∞–∫–µ—Ç -->
  <div id="layout">
    <div id="map"></div>
  </div>

  <!-- –°–∞–π–¥–±–∞—Ä -->
  <div id="sidebar">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h3 style="margin:0;">–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
      <span id="closeSidebar">‚úï</span>
    </div>
    <hr />
    <div id="upcoming"></div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js" defer></script>
  <script>
  // –ñ—ë—Å—Ç–∫–∏–π –±–æ–∫—Å –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ —Å –Ω–µ–±–æ–ª—å—à–∏–º –∑–∞–ø–∞—Å–æ–º.
  // –§–æ—Ä–º–∞—Ç –¥–ª—è maplibre: [minLng, minLat, maxLng, maxLat]
  const REGION_BBOX = [19.30, 54.00, 23.10, 55.60];

  // –¶–µ–Ω—Ç—Ä –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
  const START_CENTER = [20.5, 54.8];
  const START_ZOOM   = 8.2;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ MapLibre
  window.addEventListener('load', () => {
    if (!window.maplibregl) {
      console.error('MapLibre GL –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è');
      return;
    }

    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
    const maxBounds = [
      [REGION_BBOX[0], REGION_BBOX[1]], // sw [minLng, minLat]
      [REGION_BBOX[2], REGION_BBOX[3]]  // ne [maxLng, maxLat]
    ];

    const map = new maplibregl.Map({
      container: 'map',
      style: {
        "version": 8,
        "sources": {
          // –†–∞—Å—Ç—Ä–æ–≤—ã–π OSM –∫–∞–∫ –¥–µ—à—ë–≤—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
          "osm-raster": {
            "type": "raster",
            "tiles": [
              "https://a.tile.openstreetmap.org/{z}/{x}/{y}.png",
              "https://b.tile.openstreetmap.org/{z}/{x}/{y}.png",
              "https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"
            ],
            "tileSize": 256,
            // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ú–ï–°–¢–û: –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–∞–π–ª—ã –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ —Ä–µ–≥–∏–æ–Ω–∞
            "bounds": REGION_BBOX,
            "attribution": "¬© OpenStreetMap contributors"
          }
        },
        "layers": [
          { "id": "osm", "type": "raster", "source": "osm-raster" }
        ]
      },
      center: START_CENTER,
      zoom: START_ZOOM,
      minZoom: 8,
      maxZoom: 18,
      maxBounds: maxBounds,
      renderWorldCopies: false,
      dragRotate: false,
      pitchWithRotate: false,
      attributionControl: true,
      cooperativeGestures: true   // –ø—Ä–∏—è—Ç–Ω–µ–µ –Ω–∞ —Ç–∞—á–ø–∞–¥–∞—Ö/—Ç–∞—á—Å–∫—Ä–∏–Ω–∞—Ö
    });

    // –ü–æ–¥—Ä–µ–∑–∞–µ–º –∏–Ω–µ—Ä—Ü–∏—é —É –≥—Ä–∞–Ω–∏—Ü –∏ –Ω–µ –¥–∞—ë–º ¬´–≤—ã–ø–∞—Å—Ç—å¬ª
    map.on('moveend', () => {
      const b = map.getBounds();
      const within =
        b.getWest() >= REGION_BBOX[0] && b.getSouth() >= REGION_BBOX[1] &&
        b.getEast() <= REGION_BBOX[2] && b.getNorth() <= REGION_BBOX[3];
      if (!within) {
        map.fitBounds(maxBounds, { padding: 20, duration: 0 });
      }
    });

    // –ü–ª–∞–≤–Ω–∞—è –ø–µ—Ä–≤–∏—á–Ω–∞—è –ø–æ–¥–≥–æ–Ω–∫–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å ¬´–≤–æ –≤–µ—Å—å —Ä–µ–≥–∏–æ–Ω¬ª
    // map.fitBounds(maxBounds, { padding: 20, duration: 0 });

    // ===== UI: —Å–∞–π–¥–±–∞—Ä =====
    const sidebar = document.getElementById('sidebar');
    const burger  = document.getElementById('burger');
    const closeSb = document.getElementById('closeSidebar');
    burger.addEventListener('click', () => sidebar.classList.add('open'));
    closeSb.addEventListener('click', () => sidebar.classList.remove('open'));

    // ===== –ó–∞–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–¥ ¬´–±–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è¬ª (–∑–∞–≥–ª—É—à–∫–∞) =====
    const upcoming = document.getElementById('upcoming');
    upcoming.innerHTML = [
      { title: '–ö–æ–Ω—Ü–µ—Ä—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ',      when: '–°–µ–≥–æ–¥–Ω—è 20:00', where: '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥' },
      { title: '–õ–µ–∫—Ü–∏—è –ø–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ', when: '–ó–∞–≤—Ç—Ä–∞ 18:30',  where: '–ë–§–£' },
      { title: '–°–∫–µ–π—Ç-–¥–∂–µ–º',            when: '–°—É–±–±–æ—Ç–∞ 14:00', where: '–°—Ç–∞–¥–∏–æ–Ω' }
    ].map(e => `
      <div class="item">
        <div><strong>${e.title}</strong></div>
        <div>${e.when} ‚Äî ${e.where}</div>
      </div>
    `).join('');

    // ===== –î–∞—Ç–∞: –ø–æ–¥—Ö–≤–∞—Ç ¬´—Å–µ–≥–æ–¥–Ω—è¬ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é =====
    const dateInput = document.getElementById('event-date');
    dateInput.valueAsDate = new Date();

    // ===== –ú–∏–∫—Ä–æ-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∞ =====
    // 1) –û—Ç—Ä—É–±–∞–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Ä–µ–±–∏–ª–¥—ã —Å—Ç–∏–ª–µ–π
    let resizeTimer = null;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => map.resize(), 150);
    });

    // 2) –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º –æ–±—ä—ë–º –±—É—Ñ–µ—Ä–∞ –∑–∞ —ç–∫—Ä–∞–Ω–æ–º (–¥–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–Ω–∏—Ç–æ—Ä–æ–≤)
    // MapLibre –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –∞–Ω–∞–ª–æ–≥–∞ keepBuffer –¥–ª—è raster, –Ω–æ maxBounds+bounds —É–∂–µ —Å–∏–ª—å–Ω–æ —ç–∫–æ–Ω–æ–º–∏—Ç –∑–∞–ø—Ä–æ—Å—ã.
  });
  </script>
</body>
</html>
